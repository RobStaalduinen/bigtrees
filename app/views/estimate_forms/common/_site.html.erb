<script>
  function submitSite(){
    let form = document.getElementById("site-form");

    if(!form.checkValidity()){
      document.getElementById('site-submit').click();
      return;
    }

    let street = document.querySelector('input[name="street"]').value;
    let city = document.querySelector('input[name="city"]').value;

    let wood = document.querySelector('input[name="wood_removal"]:checked').value;
    let vehicle = document.querySelector('input[name="vehicle_access"]:checked').value;
    let breakables = document.querySelector('input[name="breakables"]:checked').value;
    let access_width = document.querySelector('input[name="access_width"]').value;
    let access_width_unit = document.querySelector('select[name="access_width_unit"]').value;

    let params = {
      site:{
        street: street,
        city: city,
        wood_removal: wood,
        vehicle_access: vehicle,
        breakables: breakables,
      }
    }

    if(displayAccess){
      params.site.access_width = `${access_width} ${access_width_unit}`;
    }

    var xmlhttp = new XMLHttpRequest();

    xmlhttp.open("POST", `/estimates/${estimateId}/sites`);
    xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xmlhttp.send(JSON.stringify(params));

    xmlhttp.onload = function(){  
      nextForm();
    }
  }

  function setupQuestions(){
    let accessField = document.getElementById("access-question");

    if(displayAccess){
      accessField.style.display = 'flex';
    }
    else{
      accessField.style.display = 'none';
    }
  }

</script>

<%= form_tag('/#', method: :post, id: 'site-form') do %>
<div id='estimate-form__container'>
  <div id='estimate-form__question'>
    Tell us a bit about your site.
  </div>

  <div class='estimate-form__field-group'>
    <div class='estimate-form__label'>
      Street and Number
    </div>
    <%= text_field_tag('street', '' , id: 'estimate-form__field', required: true) %>
  </div>

  <div class='estimate-form__field-group'>
    <div class='estimate-form__label'>
      City
    </div>
    <%= text_field_tag('city', '' , id: 'estimate-form__field', required: true) %>
  </div>

  <div class='estimate-form__field-group'>
    <div class='estimate-form__label'>
      Do you want the wood removed?
    </div>
    <div id='estimate-form__radio-question'>
      <%= 
        render 'form_components/radio_field',
        label: 'No',
        name: 'wood_removal',
        value: false,
        checked: false
      %>

      <%= 
        render 'form_components/radio_field',
        label: 'Yes',
        name: 'wood_removal',
        value: true,
        checked: true
      %>
    </div>
  </div>

  <div class='estimate-form__field-group'>
    <div class='estimate-form__label'>
      Is there vehicle access to your trees?
    </div>
    <div id='estimate-form__radio-question'>
      <%= 
        render 'form_components/radio_field',
        label: 'No',
        name: 'vehicle_access',
        value: false,
        checked: true
      %>

      <%= 
        render 'form_components/radio_field',
        label: 'Yes',
        name: 'vehicle_access',
        value: true,
        checked: false
      %>
    </div>
  </div>

  <div class='estimate-form__field-group'>
    <div class='estimate-form__label'>
      Are there breakables near your trees?
    </div>
    <div id='estimate-form__radio-question'>
      <%= 
        render 'form_components/radio_field',
        label: 'No',
        name: 'breakables',
        value: false,
        checked: true
      %>

      <%= 
        render 'form_components/radio_field',
        label: 'Yes',
        name: 'breakables',
        value: true,
        checked: false
      %>
    </div>
  </div>

  <div class='estimate-form__field-group' id ='access-question' style="display: none;">
    <div class='estimate-form__label'>
      How wide is the access to your back yard? (i.e 36 inches)
    </div>
    <%= render 'estimate_forms/components/access_field' %>
  </div>

  <div id="estimate-form__submit" onClick="submitSite();">
    Next
  </div>

  <%= submit_tag "Submit", style: 'display: none', id: 'site-submit' %>

<% end %>

</div>
